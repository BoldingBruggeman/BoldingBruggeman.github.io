<!DOCTYPE html>
<html lang="en-us">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>GOTM</title>
<meta name="description" content="Describe your website">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="robots" content="all,follow">
<meta name="googlebot" content="index,follow,snippet,archive">
<link rel="stylesheet" href="https://boldingbruggeman.github.io/css/bootstrap.min.css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:400,300,700,400italic">
<link rel="stylesheet" href="https://boldingbruggeman.github.io/css/font-awesome.min.css">
<link rel="stylesheet" href="https://boldingbruggeman.github.io/css/owl.carousel.css">
<link rel="stylesheet" href="https://boldingbruggeman.github.io/css/owl.theme.css">


  <link href="https://boldingbruggeman.github.io/css/style.sea.css" rel="stylesheet" id="theme-stylesheet">

 

  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  


<link href="https://boldingbruggeman.github.io/css/custom.css" rel="stylesheet">
<link rel="shortcut icon" href="https://boldingbruggeman.github.io/img/favicon.png">


</head>
<body>
  <div id="all">
      <div class="container-fluid">
          <div class="row row-offcanvas row-offcanvas-left">
              <div id="sidebar" class="col-xs-6 col-sm-4 col-md-3 sidebar-offcanvas">
  <div class="sidebar-content">
    <h1 class="sidebar-heading"><a href="https://boldingbruggeman.github.io/">Bolding &amp; Bruggeman (BB)</a></h1>
    
      <p class="sidebar-p">BB develops and applies advanced numerical models for natural waters.</p>
    
      <p class="sidebar-p">Bolding & Bruggeman ApS - BB - (until autumn 2014 Bolding & Burchard ApS) was established by Hans Burchard and Karsten Bolding in Varese, Italy 1999. Hans Burchard and Karsten Bolding were equal partners until 2014, when Jorn Bruggeman replaced Hans Burchard. BB is a research and development company specializing in numerical models for lakes and oceans.</p>
    
    <ul class="sidebar-menu">
      
        <li><a href="https://boldingbruggeman.github.io/">Home</a></li>
      
        <li><a href="https://boldingbruggeman.github.io/portfolio/">Portfolio</a></li>
      
        <li><a href="https://boldingbruggeman.github.io/business/">Business</a></li>
      
        <li><a href="https://boldingbruggeman.github.io/workshops/">Workshops</a></li>
      
        <li><a href="https://boldingbruggeman.github.io/about/">About</a></li>
      
        <li><a href="https://boldingbruggeman.github.io/contact/">Contact</a></li>
      
    </ul>
    <p class="social">
  
  
  
  
  
  <a href="mailto:karsten@bolding-bruggeman.com" data-animate-hover="pulse" class="email">
    <i class="fa fa-envelope"></i>
  </a>
  
  
  
  
  <a href="https://github.com/boldingbruggeman" data-animate-hover="pulse" class="external">
    <i class="fa fa-github"></i>
  </a>
  
  
  
</p>


    <div class="copyright">
      <p class="credit">
        
          &copy;2017 BB |
        
        Template by <a href="https://bootstrapious.com/free-templates" class="external">Bootstrapious.com</a>

&amp; ported to Hugo by <a href="https://github.com/kishaningithub">Kishan B</a>

      </p>
    </div>
  </div>
</div>

              
<div class="col-xs-12 col-sm-8 col-md-9 content-column white-background">
  <div class="small-navbar visible-xs">
  <button type="button" data-toggle="offcanvas" class="btn btn-ghost pull-left"> <i class="fa fa-align-left"> </i>Menu</button>
  <h1 class="small-navbar-heading"><a href="https://boldingbruggeman.github.io/">Bolding &amp; Bruggeman (BB)</a></h1>
</div>

  <div class="row">
    <div class="col-lg-8">
      <div class="content-column-content">
         <h1>GOTM</h1>
         <p>The General Ocean Turbulence model is both a state-of-the-art turbulence
library for flows in natural waters and a 1D water column model.</p>
<ul>
<li><a href="#developments-by-bb">Developments by BB</a>
<ul>
<li><a href="#yaml-configuration">YAML configuration</a></li>
<li><a href="#output-operators">Output operators</a></li>
<li><a href="#data-assimilation">Data assimilation</a></li>
<li><a href="#hotstart">Hotstart</a></li>
</ul>
</li>
</ul>
<p>GOTM was initiated by Hans Burchard and Karsten Bolding in 1998 and the first
public release was in 1999. BB has always been responsible for maintaining
the code – first using CVS and later using git. BB has provided numerous code
contributions and has participated very active on the developers and users
mailing lists.</p>
<p>The turbulence library of GOTM is used in a number of 3D ocean models - such as</p>
<p>GOTM is used as the primary test bed for Framework for Biogeochemical Models
<a href="portfolio/fabm/">FABM</a>.</p>
<p>GOTM has its own <a href="http://www.gotm.net">web-site</a> where in-depth information can be found.</p>
<p>Here we will just provide some information on new features BB is doing on the core
GOTM code. This does not include utilities described elsewhere on this site -
but only changes to the core part of the GOTM source code. This is typically
new features that requires a significant knowledge of the entire code base - but
also quite some resources in terms of implementation and testing time.</p>
<h2 id="developments-by-bb">Developments by BB</h2>
<p>The table below describes the on-going GOTM developments at BB. As described
<a href="/business/">here</a> it is very difficult to get funding for pure model development.
On the other hand - to bring things forward - you can&rsquo;t wait for funding agencies
to be ready.</p>
<p>BB has therefor initiated projects using BB resources - that hopefully someday can be
released for general use - but it will require funds.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<hr>
<h3 id="yaml-configuration">YAML Configuration</h3>
<h4 id="rationale">Rationale</h4>
<p>Until now GOTM has been configured through a combination of <em>namelists</em> (in a number of files) and text files (scalar time-series and profiles). Namelists - being a standard Fortran feature - has clear advantages and replacing them with a costum configuration system must be carefully evaluated. The main disadvantage of namelists is - they are Fortran only - i.e. any manipulation of the namelists must be done either in an editor or through costum made tools (like <em>editscenario</em>). New use cases of GOTM - e.g. auto-calibration - requires a flexible easy maintainable system for generating ensembles of configurations in a non-interactive way. FABM and the output manager in GOTM already uses YAML as configuration format so replacing namelists with a YAML-formatted configuration file seems the obvious choice.</p>
<h4 id="implementation-details">Implementation details</h4>
<p>The implementation depends on the Fortran YAML library developed by Jorn Bruggeman and briefly described <a href="https://bolding-bruggeman.com/portfolio/yaml/">here</a>.</p>
<p>To ease the transition from namelist based configuration to YAML-based a method for converting namelists to a YAML-file has been implemented via command line options as seen in the figure below.
<figure>
    <img src="/portfolio/img/yaml_config.png"/> 
</figure>
</p>
<p>The default - calling GOTM executable without any options - will read <em>gotm.yaml</em>. Skipping reading <em>gotm.yaml</em> can be achieved by specifying <em>&ndash;no_read_yaml_file</em>. Reading an existing - working - namelist configuration can be done be specifying <em>&ndash;read_nml_files</em>. Saving the final configuration to a new YAML-formatted file can be done by specifying <em>&ndash;save_yaml <!-- raw HTML omitted --></em> where file is the name of the target YAML file.</p>
<p>To create a starting point for a new configuration with default parameter settings the following command can be used: <em>gotm &ndash;save_yaml default.yaml</em>.</p>
<p>To convert an existing namelist based configuration use this command: <em>gotm  &ndash;read_nml_files &ndash;save_yaml gotm.yaml</em></p>
<h4 id="present-status">Present status</h4>
<p>The code is presently in a private BB development Gitlab repository. When feature complete the code will be moved to a public branch of the main GOTM Github repository for discussion and testing.</p>
<p>Presently <em>output.yaml</em> has not been merged with <em>gotm.yaml</em> - if it will depends on some further workflow experiences.</p>
<hr>
<h3 id="output-operators">Output operators</h3>
<p>The <em>flexible output</em> facility used in GETM and GOTM have changed the way output is done. Much of the work previously done as post-processing is now done as part of model simulation. This has advantages and dis-advantages. The main dis-advantage being that the wall clock time for a given simulation will increase - because of the extra work being done. This is, however, usually more than compensated by the reduced time in the normal post-processing. The main advantage is the flexibility introduced to the output specifications. A mix of resolutions in space and time for different output regions can be defined without having to save everything with the highest space and time resolution to accomplish all possible combinations - as has been the case until now.
Have being used for some time in operational mode at FMI/GeoMETOC has made apparant the need for additional features in relation to 1) <em>timing of calculations</em> of derived fields and 2) a more flexible reference for the vertical coordinate used in the outputs.</p>
<h4 id="rationale-1">Rationale</h4>
<p>With the flexible output it is possible store any number of domains defined as hyper-slabs of the full domain in all 4 dimensions (x, y, z, t) through specifications in a YAML formatted file. This allows to e.g. save data from a station like region in high temporal resulution and on the other hand save the entire calculation domain in a reduced resultion to save space. Note that since any number of different outputs can be defined</p>
<h4 id="implementation-details-1">Implementation details</h4>
<p>The <em>timing of calculations</em> is implemented as an additional logical variable in the output Fortran class. During the integration the output manager sets the variable to <em>true</em> if the variable is to be stored in the present time step. The algorithm taking care of the calculation of the derived field will check the status of the variable - and if <em>true</em> do the calculation.</p>
<p>The <em>output operators</em> are implemented as a Fortran class library interacting with a field manager (to obtain meta-data for involved fields) and a YAML parsing library (for flexible configuration).
Being a class library the functionality can easily be extended to include new operators without influencing the overall structure. Presently are implemented an interpolation operator that will do interpolation along a coordinate axis and a time averaging operator.
The background for the operators is online conversion - and storage - of fields with geo-potential (z) coordinate from sigma-coordinate type of models.</p>
<h4 id="present-status-1">Present status</h4>
<p>The <em>output operators</em> have been merged into the master GOTM repository as of <!-- raw HTML omitted -->January 2019nd<!-- raw HTML omitted --> can be used by both GOTM and GETM. Below is an example of a GETM configuration defining a station type output interpolating the sigma-coordinate model field to a z-coordinate field using the sea surface a reference.</p>
<figure>
    <img src="/portfolio/img/operators.png"/> 
</figure>

<p>The example will create a file - middle_station.nc - where the temperature is saved every hour for the center positon in box_cartesian test case. The output will use the <em>interp</em> operator and store interpolated values at the coordinates given using the sea surface as reference (z). The out_of_bounds and target* variables are optional.</p>
<p>The short manual provided as part of the project can be download <a href="/portfolio/output_operators.pdf">here</a>.</p>
<hr>
<h3 id="data-assimilation">Data Assimilation</h3>
<p>Nothing yet</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<hr>
<h3 id="hotstart">Hotstart</h3>
<h4 id="rationale-2">Rationale</h4>
<p>Even though GOTM simulations typically executes quite fast there are use cases
where dividing the simulation in parts do make sense. One example is when doing i
a coupled physical/bio-geochemical simulation. It is desirable to have the i
physical fields in balance before bio-geochemistry is switched on. A second example i
is when doing ensemble data-assimilation studies. Here starting the simulation i
from a analyzed state is mandatory.</p>
<h4 id="implementation-details-2">Implementation details</h4>
<p>The hotstart feature in GOTM is implemented on top if the <em>field_manager</em> utilising
the possibility to add attributes to variables. For state variables – and other
variables necessary to perform a hotstart – an extra attribute state is added during
registration in the <em>field_manager</em>. The <em>output_manager</em> utilizes the state attribute
information when creating a list of fields that must be either written to - or read
from - the hotstart file. The link to the data in the NetCDF formatted hotstart file
is done through the name variable in <em>the field_manager</em>. Having no hard-coded link
between variables names in the model code and data in the hotstart file make a very
flexible and extendable scheme. Bio-geochemical models not even implemented in FABM
will work seamlessly during hotstart.</p>
<p>The use of the hotstart facility is controlled through two variables in the
<strong>gotm_run.nml</strong> namelist. A boolean – <strong>hotstart_offline</strong> – and a variable to hold
the name of the file with the hotstart data – <strong>hotstart_file</strong>. If hotstart_offline
is true the time information in the time namelist must match the time information
contained in hotstart_file.</p>
<h4 id="present-status-2">Present status</h4>
<p>The implementation is finished. The correctness of implementation has been tested in the following way:</p>
<ul>
<li>A full simulation is done and the hotstart file is saved.</li>
<li>A new simulation is made identical to the original one – but including a hotstart time sometime during the simulation period. The hotstart file from the final part of the simulation is saved.</li>
<li>The two saved hotstart files are compared using the md5sum algorithm. If the sums are identical so are the hotstart files – and so are the simulations.</li>
</ul>
<p>Below is shown the result from the Northern North Sea (nns_annual) standard
test case. A hot-start has been injected at july 1st in the simulation year.</p>
<figure>
    <img src="/portfolio/img/hotstart_md5sum.png"/> 
</figure>

<hr>
         
         <h6><a href="https://boldingbruggeman.github.io/">Home</a></h6>
      </div>
    </div>
  </div>
</div>

          </div>
      </div>
  </div>
  <script src="https://boldingbruggeman.github.io/js/jquery.min.js"></script>
<script src="https://boldingbruggeman.github.io/js/bootstrap.min.js"></script>
<script src="https://boldingbruggeman.github.io/js/jquery.cookie.js"> </script>
<script src="https://boldingbruggeman.github.io/js/ekko-lightbox.js"></script>
<script src="https://boldingbruggeman.github.io/js/jquery.scrollTo.min.js"></script>
<script src="https://boldingbruggeman.github.io/js/masonry.pkgd.min.js"></script>
<script src="https://boldingbruggeman.github.io/js/imagesloaded.pkgd.min.js"></script>
<script src="https://boldingbruggeman.github.io/js/owl.carousel.min.js"></script>
<script src="https://boldingbruggeman.github.io/js/front.js"></script>



</body>
</html>
